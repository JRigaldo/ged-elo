<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div style="
        background: #FFF; 
        width: 100vw;
        height: 100vh;
        display: flex;
        display: -webkit-box; 
        display: -moz-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        justify-content: center;
        align-items: center;
        ">
        <div id="chat-container" style="
    padding: 10px;
    border-radius: 5px;
    display: flex;
    display: -webkit-box; 
    display: -moz-box;
    display: -ms-flexbox;
    display: -webkit-flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;

    width: 100%;
    max-width: 500px;

    overflow-y: auto;
    overflow-x: hidden;
    ">
    <h3>Réponse de l'assistant</h3>
        <div id="chatMessageInput" style="
            height: 200px;
            overflow-y: scroll;
            border: 1px solid #ddd;
            padding: 5px;
            margin-bottom: 10px;
            width: 100%;
            background-color: #F5F7F8;

            border-radius: 5px;
            margin-bottom: 10px;

        "></div>
        
        <input type="text" id="userMessageInput" placeholder="Écrivez votre question..." style="
            width: 100%;
            padding: 5px;
            border: 1px solid #ddd;
            
            border-radius: 5px;
            margin-bottom: 10px;

            overflow: hidden;
        ">
        <button onclick="sendMessage()" style="
        border-radius: 10px;
        background-color: #F2940A;
        color: #FFF;
        padding: 0.5rem 1rem;
        border: none;
        box-shadow: 0px 0px 10px 2px rgba(0,0,0,0.4);
        -webkit-box-shadow: 0px 0px 10px 2px rgba(0,0,0,0.4);
        -moz-box-shadow: 0px 0px 10px 2px rgba(0,0,0,0.4);
        ">Envoyer</button>
    </div>

    <script>
        
        const test = test => console.log(test);
        async function sendMessage() {
            const userMessageInput = document.getElementById('userMessageInput').value;
            const chatBox = document.getElementById('chatMessageInput');
            chatBox.innerHTML += `<div><strong>Vous:</strong> ${userMessageInput}</div>`;
            
            const response = await getChatGPTResponse(userMessageInput);
            chatBox.innerHTML += `<div><strong>ChatGPT:</strong> ${response}</div>`;
            
            // Scroller jusqu'au bas du chat
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        async function getChatGPTResponse(prompt) {
            const apiUrl = 'https://172.16.16.82:443/chatGPT';

            try {
                const responsePromise = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: [{role: "user", content: prompt}],
                        context: "Tu es un expert du logiciel ELO, tu vas aider les utilisateurs du logiciel ELO lors de l'utilisation du logiciel. Tu seras bienveillant. Tu vas leur indiquer comment faire ce qu'il te demande avec le logiciel ELO. Tu ne dois pas répondre à  d'autres questions, quel que soit le sujet.",
                        conversation: []
                    })
                })
                .then(response => {
                    console.log('Response from server:', response);
                    return response.choices[0].message.content;                    
                })
                .catch(error => console.error('Error to fetch data:', error));

                if (!responsePromise.ok) {
                    throw new Error(`Response status: ${responsePromise.status}`);
                }else{
                    const jsonData = await responsePromise.json();
                    console.log('jsonData', jsonData)
                    return jsonData;
                }

            } catch (error) {
                console.error("Erreur lors de l'appel à l'API ChatGPT :", error);
                return "Désolé, une erreur s'est produite.";
            }
        }
    </script>
    </div>
</body>
</html>